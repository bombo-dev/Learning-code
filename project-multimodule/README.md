# 최종 프로젝트 멀티 모듈 회고

최종 프로젝트를 진행하면서 멀티 모듈 설계에서 겪었던 이슈들을 몇 가지 공유하고자 한다.

먼저, 초기에 계획 된 우리 팀의 멀티모듈 구조는 다음과 같이 설계되었다.
[사진]

위 사진처럼 멀티모듈 구조를 레이어별로 가져가기로 했다.

레이어별로 구조를 가져가기 이전에 먼저 모듈을 어떻게 가져가는 것이 좋을지에 대해 팀원들과 얘기를 나누었다.

하지만, 프로젝트 기간이 짧은 만큼 도메인이 많이 발생 할 것으로 예상되지 않고 멀티 모듈을 구성했을 때 모듈 별로 부트 서버를 따로 띄울 일이 프로젝트 구조 상 발생하지 않을 것 같다는 전제에서 시작했다.

고민을 레이어별로 모듈을 나누는 것과 도메인 별로 모듈을 나누는 것 두 가지를 고려했기 때문에 자연스럽게 레이어 별로 모듈을 가져가기로 결정하였다.

참고로, 멀티모듈을 어떻게 가져가는 것이 좋을까에 대해서는 다음과 같은 링크들을 참조했다.

https://techblog.woowahan.com/2637/
https://www.youtube.com/watch?v=uvG-amw2u2s
https://www.youtube.com/watch?v=ipDzLJK-7Kc
https://jojoldu.tistory.com/123

## 첫 번째 이슈

우리는 프로젝트를 진행하면서 Domain 영역에서는 Spring Data Jpa를 의존한다.
이상적으로는 Domain에는 그 어떤 것도 의존하지 않고 (JPA 포함) 도메인에 대한 비즈니스 로직만이 있는 것이 좋을 것 같다고 생각했지만 개발 비용이 전체적으로 올라갈 수 있겠다고 판단하여 도메인 모듈은 JPA를 의존하도록 하였다.

그리고 이후에 동적 쿼리를 적용하기 위해 QueryDSL을 위한 설정을 미리 해두기로 결정하였다.

우리 팀은 QueryDSL 또한 Infra 영역에 속한다고 판단하였다.
QueryDSL 자체를 외부에서 사용하고 변경 가능성이 있는 모듈이라고 생각했기 때문이다.

따라서, Domain 모듈이 QueryDSL이 있는 Infra 모듈을 다음과 같이 의존하도록 설계하였다.
[사진]

여기서, 이슈가 발생을 했다. QueryDSL에 있는 Infra 영역에서 Domain에 대한 QClass를 생성 할 방법을 찾지 못했다.

분명히, 방법이 있을 것이라고 생각했지만 Gradle에 대한 이해도가 아직 낮아서인지 Domain에 있는 JPA Class를 읽어서 Infra 영역에 생기게 끔 할 방법을 찾을 수 없었다.

여기서, 선택이 필요했다. QueryDSL을 어떻게 할 것 인지. 이걸 외부의 기술로 볼 것인지 말이다.

팀원들과의 의논 끝에 QueryDSL도 결국 JPA에 의존을 하게 된다. 이미 도메인에서 JPA를 의존하고 있으니 QueryDSL도 Domain에서 의존하게 하여 간편하게 가져가자.
(마치 common에 몰아넣기 같은 문제가 벌써 발생하고 있다.)

이렇게 Domain 영역에 QueryDSL의 의존성이 추가되게 되었다. 다만, QueryDSL이 담겨있는 코드는 QueryDSL이 있는 Infra 영역에서 구현하게 끔 하는 것이 어떤가 하는 의견이 나왔다.

queryDSL을 작성하기로 한 Module이 Domain 모듈을 의존하고 있기 때문에 DIP를 활용하여 코드 구조를 깔끔하게 가져 갈 수 있을 것이라고 생각했다.

[사진]
그리고 구조를 위 사진과 같이 가져가게 되었다.

여기서, 두 번째 이슈가 발생한다.

## 두 번째 이슈

QueryDSL을 이용하여 구현한 class를 해당 클래스의 의존관계에서는 위와 같이 참조가 끊겼기에 classPath에서 찾지 못하였고 Spring Data Jpa가 해당 메서드명에 맞는 쿼리를 자동 생성하고자 시도하고 명명규칙이 맞지 않아 생성 할 수 없는 문제가 발생하게 되었다.
